#!/usr/bin/env sh
set -e

printf "\n\033[1;36m[husky] pre-commit: lint + typecheck + tests + complexity\033[0m\n"
printf "[husky] staged files:\n" && git diff --cached --name-only || true

printf "\n[husky] running lint-staged...\n"
pnpm exec lint-staged

# Require at least one test file to exist in the repository
printf "\n[husky] checking test files exist...\n"
node scripts/ensure-tests-exist.mjs

printf "\n[husky] running tests...\n"
# pnpm test

printf "\n[husky] generating complexity JSON...\n"
pnpm run complexity:json
printf "[husky] enforcing FTA cap...\n"
# node scripts/check-fta-cap.mjs

printf "\n\033[1;32m[husky] pre-commit passed.\033[0m\n\n"
